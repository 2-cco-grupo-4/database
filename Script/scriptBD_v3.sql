CREATE USER 'picmeUser'@'localhost' IDENTIFIED BY 'picme123';
DROP DATABASE picme;
CREATE DATABASE picme;
GRANT ALL PRIVILEGES ON picme.* TO 'picmeUser'@'localhost';
USE picme;



-- Criação da tabela Usuario
CREATE TABLE USUARIO (
    ID_USUARIO BIGINT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(120),
    CPF VARCHAR(14),
    EMAIL VARCHAR(256),
    SENHA VARCHAR(100),
    DATA_NASCIMENTO DATE,
    AUTENTICADO BOOL,
    CELULAR VARCHAR(20),
    DATA_CADASTRO DATE,
    TIPO_USUARIO TINYINT,
    TOKEN_SOLICITACAO VARCHAR(100),
    INDEX(CPF),
    INDEX(EMAIL)
);

-- Criação da tabela de log de acessos dos usuários
CREATE TABLE LOG_ACESSOS (
	ID_LOG_ACESSOS BIGINT AUTO_INCREMENT PRIMARY KEY,
    DATA_LOGIN DATE NOT NULL,
    FK_USUARIO BIGINT,
    FOREIGN KEY (FK_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

-- Criação da tabela de log de pesquisa dos usuários
CREATE TABLE LOG_PESQUISAS (
	ID_LOG_PESQUISAS BIGINT AUTO_INCREMENT PRIMARY KEY,
    TERMO_BUSCA VARCHAR(150) NOT NULL,
    DATA_PESQUISA DATE NOT NULL,
    FK_USUARIO BIGINT,
    FOREIGN KEY (FK_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

-- Criação da tabela Tema
CREATE TABLE TEMA (
    ID_TEMA BIGINT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(50)
);

-- Criação da tabela TemasUsuario
CREATE TABLE USUARIO_TEMA (
  ID_USUARIO BIGINT,
  ID_TEMA BIGINT,
  PRIMARY KEY (ID_USUARIO, ID_TEMA),
  FOREIGN KEY (ID_TEMA) REFERENCES TEMA(ID_TEMA),
  FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

-- Criação da tabela SESSAO
CREATE TABLE SESSAO (
    ID_SESSAO BIGINT AUTO_INCREMENT PRIMARY KEY,
    DATA_REALIZACAO DATE NOT NULL,
    STATUS_SESSAO VARCHAR(20) NOT NULL,
    FK_FOTOGRAFO BIGINT,
    FK_TEMA BIGINT,
    FK_CLIENTE BIGINT,
    FOREIGN KEY (FK_FOTOGRAFO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY (FK_TEMA) REFERENCES TEMA(ID_TEMA),
    FOREIGN KEY (FK_CLIENTE) REFERENCES USUARIO(ID_USUARIO)
);

-- Criação da tabela Endereco
CREATE TABLE ENDERECO (
    ID_ENDERECO BIGINT AUTO_INCREMENT PRIMARY KEY,
    ESTADO VARCHAR(50),
    CIDADE VARCHAR(50),
    CEP VARCHAR(10),
    BAIRRO VARCHAR(80),
    LOGRADOURO VARCHAR(100),
    NUMERO VARCHAR(10),
    COMPLEMENTO VARCHAR(30),
    FK_SESSAO BIGINT,
    FOREIGN KEY (FK_SESSAO) REFERENCES SESSAO(ID_SESSAO)
);

-- Criação da tabela Album
CREATE TABLE ALBUM (
    ID_ALBUM BIGINT AUTO_INCREMENT PRIMARY KEY,
    TITULO VARCHAR(100) NOT NULL,
    DESCRICAO VARCHAR(100),
    FK_FOTOGRAFO BIGINT,
    FK_TEMA BIGINT,
    FOREIGN KEY (FK_FOTOGRAFO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY (FK_TEMA) REFERENCES TEMA(ID_TEMA)
);

-- Criação da tabela Imagem
CREATE TABLE IMAGEM (
    ID_IMAGEM BIGINT AUTO_INCREMENT PRIMARY KEY,
    CAMINHO VARCHAR(500),
    DESCRICAO VARCHAR(100),
    FORMATO VARCHAR(5),
    FK_ALBUM BIGINT,
    FOREIGN KEY (FK_ALBUM) REFERENCES ALBUM(ID_ALBUM)
);

-- Tabela Tag
CREATE TABLE TAG (
  ID_TAG BIGINT AUTO_INCREMENT PRIMARY KEY,
  NOME VARCHAR(100)
);

-- Tabela TagsImagem
CREATE TABLE TAG_IMAGEM (
  ID_IMAGEM BIGINT,
  ID_TAG BIGINT,
  PRIMARY KEY (ID_IMAGEM, ID_TAG),
  FOREIGN KEY (ID_IMAGEM) REFERENCES IMAGEM(ID_IMAGEM),
  FOREIGN KEY (ID_TAG) REFERENCES TAG(ID_TAG)
);

-- Tabela InteressesTags
CREATE TABLE USUARIO_TAG (
  ID_TAG BIGINT,
  ID_USUARIO BIGINT,
  PRIMARY KEY (ID_TAG, ID_USUARIO),
  FOREIGN KEY (ID_TAG) REFERENCES TAG(ID_TAG),
  FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

-- Criação da tabela de avaliação dos SESSAOs
CREATE TABLE AVALIACAO (
	ID_AVALIACAO BIGINT AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO VARCHAR (300),
    NOTA DOUBLE NOT NULL,
    FK_SESSAO BIGINT,
    INDEX(NOTA),
    FOREIGN KEY (FK_SESSAO) REFERENCES SESSAO(ID_SESSAO)
);

-- Criação da tabela de pagamentos que detalha como o pagamento da sessão foi realizado
CREATE TABLE PAGAMENTO (
	ID_PAGAMENTO BIGINT AUTO_INCREMENT PRIMARY KEY,
    FORMA VARCHAR(60) NOT NULL,
    VALOR DECIMAL NOT NULL,
    PARCELAS INT NOT NULL,
    FK_SESSAO BIGINT,
    FOREIGN KEY (FK_SESSAO) REFERENCES SESSAO(ID_SESSAO)
);

-- Criação da tabela de log das sessões
CREATE TABLE LOG_SESSAO (
	ID_LOG_SESSAO BIGINT AUTO_INCREMENT PRIMARY KEY,
    DATA_MODIFICACAO DATE NOT NULL,
    STATUS_SESSAO VARCHAR (20) NOT NULL,
    DATA_REALIZACAO DATE NOT NULL,
    FK_SESSAO BIGINT,
    FOREIGN KEY (FK_SESSAO) REFERENCES SESSAO(ID_SESSAO)
)

-- Tabela LogsPaginasSite
-- CREATE TABLE LOG_PAGINA_SITE (
--   ID_LOG_PAGINA_SITE INT PRIMARY KEY,
--   SESSAO_ATIVA INT,
--   TEMPO_DURACAO_SESSAO DOUBLE,
--   DATA_SESSAO DATE,
--   QTD_NOVA_SESSAO INT,
--   TOTAL_VIEW_PAGINA INT,
--   LOG_PAGINA_SITECOL VARCHAR(45)
-- );